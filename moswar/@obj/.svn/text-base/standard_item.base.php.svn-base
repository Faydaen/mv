<?php
class standard_itemBaseObject extends Object
{
	public static $METAOBJECT = 'standard_item';
    public static $ID_METAATTRIBUTE = 'standard_item.id';
 	public static $ID = 'standard_item.id';
    public $name = '';
    public static $NAME = 'standard_item.name';
    public $maxdurability = 0;
    public static $MAXDURABILITY = 'standard_item.maxdurability';
    public $image = '';
    public static $IMAGE = 'standard_item.image';
    public $slot = '';
    public $slot_Dictionary = array('weapon','pouch','cloth','cologne','talisman','accessory1','accessory2','accessory3','accessory4','accessory5','hat','jewellery','tech','shoe');
    public static $SLOT = 'standard_item.slot';
    public $type = '';
    public $type_Dictionary = array('weapon','pouch','cloth','cologne','talisman','accessory1','accessory2','accessory3','accessory4','accessory5','home_comfort','home_defence','home_safe','pick','metro','pet','drug','gift','petfood','hat','jewellery','tech','shoe','petautofood','quest','usableitem','docs','drug2','gift2','home','autousableitem','ring');
    public static $TYPE = 'standard_item.type';
    public $itemlevel = 0;
    public static $ITEMLEVEL = 'standard_item.itemlevel';
    public $upgradable = 0;
    public static $UPGRADABLE = 'standard_item.upgradable';
    public $stackable = 0;
    public static $STACKABLE = 'standard_item.stackable';
    public $sellable = 0;
    public static $SELLABLE = 'standard_item.sellable';
    public $usable = 0;
    public static $USABLE = 'standard_item.usable';
    public $time = '';
    public static $TIME = 'standard_item.time';
    public $health = 0;
    public static $HEALTH = 'standard_item.health';
    public $strength = 0;
    public static $STRENGTH = 'standard_item.strength';
    public $dexterity = 0;
    public static $DEXTERITY = 'standard_item.dexterity';
    public $intuition = 0;
    public static $INTUITION = 'standard_item.intuition';
    public $resistance = 0;
    public static $RESISTANCE = 'standard_item.resistance';
    public $attention = 0;
    public static $ATTENTION = 'standard_item.attention';
    public $charism = 0;
    public static $CHARISM = 'standard_item.charism';
    public $level = 0;
    public static $LEVEL = 'standard_item.level';
    public $money = 0;
    public static $MONEY = 'standard_item.money';
    public $honey = 0;
    public static $HONEY = 'standard_item.honey';
    public $ore = 0;
    public static $ORE = 'standard_item.ore';
    public $info = '';
    public static $INFO = 'standard_item.info';
    public $oil = 0;
    public static $OIL = 'standard_item.oil';
    public $hp = 0;
    public static $HP = 'standard_item.hp';
    public $uniq = 0;
    public static $UNIQ = 'standard_item.uniq';
    public $buyable = 0;
    public static $BUYABLE = 'standard_item.buyable';
    public $code = '';
    public static $CODE = 'standard_item.code';
    public $sex = '';
    public $sex_Dictionary = array('male','female');
    public static $SEX = 'standard_item.sex';
    public $unlocked = 0;
    public static $UNLOCKED = 'standard_item.unlocked';
    public $unlockedby = '';
    public static $UNLOCKEDBY = 'standard_item.unlockedby';
    public $type2 = '';
    public $type2_Dictionary = array('player','clan','fraction');
    public static $TYPE2 = 'standard_item.type2';
    public $usestate = '';
    public $usestate_Dictionary = array('normal','fight');
    public static $USESTATE = 'standard_item.usestate';
    public $shopdt1 = '0000-00-00 00:00:00';
    public static $SHOPDT1 = 'standard_item.shopdt1';
    public $shopdt2 = '0000-00-00 00:00:00';
    public static $SHOPDT2 = 'standard_item.shopdt2';
    public $ratingcrit = 0;
    public static $RATINGCRIT = 'standard_item.ratingcrit';
    public $ratingdodge = 0;
    public static $RATINGDODGE = 'standard_item.ratingdodge';
    public $ratingresist = 0;
    public static $RATINGRESIST = 'standard_item.ratingresist';
    public $ratinganticrit = 0;
    public static $RATINGANTICRIT = 'standard_item.ratinganticrit';
    public $ratingdamage = 0;
    public static $RATINGDAMAGE = 'standard_item.ratingdamage';
    public $ratingaccur = 0;
    public static $RATINGACCUR = 'standard_item.ratingaccur';
    public $maxlevel = 0;
    public static $MAXLEVEL = 'standard_item.maxlevel';
    public $subtype = '';
    public $subtype_Dictionary = array('moto','metro','rats','korovan','gift','award');
    public static $SUBTYPE = 'standard_item.subtype';
    public $special1 = '';
    public static $SPECIAL1 = 'standard_item.special1';
    public $special1name = '';
    public static $SPECIAL1NAME = 'standard_item.special1name';
    public $special2 = '';
    public static $SPECIAL2 = 'standard_item.special2';
    public $special2name = '';
    public static $SPECIAL2NAME = 'standard_item.special2name';
    public $special3 = '';
    public static $SPECIAL3 = 'standard_item.special3';
    public $special3name = '';
    public static $SPECIAL3NAME = 'standard_item.special3name';
    public $special4 = '';
    public static $SPECIAL4 = 'standard_item.special4';
    public $special4name = '';
    public static $SPECIAL4NAME = 'standard_item.special4name';
    public $special5 = '';
    public static $SPECIAL5 = 'standard_item.special5';
    public $special5name = '';
    public static $SPECIAL5NAME = 'standard_item.special5name';
    public $special6 = '';
    public static $SPECIAL6 = 'standard_item.special6';
    public $special6name = '';
    public static $SPECIAL6NAME = 'standard_item.special6name';
    public $special7 = '';
    public static $SPECIAL7 = 'standard_item.special7';
    public $special7name = '';
    public static $SPECIAL7NAME = 'standard_item.special7name';
    public $shop = '';
    public $shop_Dictionary = array('shop','berezka','perk');
    public static $SHOP = 'standard_item.shop';
    public $warzub = 0;
    public static $WARZUB = 'standard_item.warzub';
    public $wargoldenzub = 0;
    public static $WARGOLDENZUB = 'standard_item.wargoldenzub';
    public $huntbadge = 0;
    public static $HUNTBADGE = 'standard_item.huntbadge';
    public $huntmobile = 0;
    public static $HUNTMOBILE = 'standard_item.huntmobile';
    public $petriks = 0;
    public static $PETRIKS = 'standard_item.petriks';
    public $stars = 0;
    public static $STARS = 'standard_item.stars';
    public $clanlevel = 0;
    public static $CLANLEVEL = 'standard_item.clanlevel';
    public $deleteafter = '';
    public $deleteafter_Dictionary = array('date','period');
    public static $DELETEAFTER = 'standard_item.deleteafter';
    public $deleteafterdt = 0;
    public static $DELETEAFTERDT = 'standard_item.deleteafterdt';
    public $sellcost = '';
    public static $SELLCOST = 'standard_item.sellcost';

    public function __construct()
    {
        parent::__construct('standard_item');
    }

	/**
	 * Сброс значений свойств объекта
	 *
	 */
    public function reset()
    {
        $this->id = 0;
        $this->name = '';
        $this->maxdurability = 0;
        $this->image = '';
        $this->slot = '';
        $this->type = '';
        $this->itemlevel = 0;
        $this->upgradable = 0;
        $this->stackable = 0;
        $this->sellable = 0;
        $this->usable = 0;
        $this->time = '';
        $this->health = 0;
        $this->strength = 0;
        $this->dexterity = 0;
        $this->intuition = 0;
        $this->resistance = 0;
        $this->attention = 0;
        $this->charism = 0;
        $this->level = 0;
        $this->money = 0;
        $this->honey = 0;
        $this->ore = 0;
        $this->info = '';
        $this->oil = 0;
        $this->hp = 0;
        $this->uniq = 0;
        $this->buyable = 0;
        $this->code = '';
        $this->sex = '';
        $this->unlocked = 0;
        $this->unlockedby = '';
        $this->type2 = '';
        $this->usestate = '';
        $this->shopdt1 = '0000-00-00 00:00:00';
        $this->shopdt2 = '0000-00-00 00:00:00';
        $this->ratingcrit = 0;
        $this->ratingdodge = 0;
        $this->ratingresist = 0;
        $this->ratinganticrit = 0;
        $this->ratingdamage = 0;
        $this->ratingaccur = 0;
        $this->maxlevel = 0;
        $this->subtype = '';
        $this->special1 = '';
        $this->special1name = '';
        $this->special2 = '';
        $this->special2name = '';
        $this->special3 = '';
        $this->special3name = '';
        $this->special4 = '';
        $this->special4name = '';
        $this->special5 = '';
        $this->special5name = '';
        $this->special6 = '';
        $this->special6name = '';
        $this->special7 = '';
        $this->special7name = '';
        $this->shop = '';
        $this->warzub = 0;
        $this->wargoldenzub = 0;
        $this->huntbadge = 0;
        $this->huntmobile = 0;
        $this->petriks = 0;
        $this->stars = 0;
        $this->clanlevel = 0;
        $this->deleteafter = '';
        $this->deleteafterdt = 0;
        $this->sellcost = '';
    }

	/**
	 * Инициализация свойств объекта из ассоциативного массива
	 *
	 * @param array
	 */
    public function init($object)
    {
        if (isset($object['id']))
        {
            $this->id = $object['id'];
        }
        $this->name = $object['name'];
        $this->maxdurability = $object['maxdurability'];
        $this->image = $object['image'];
        $this->slot = $object['slot'];
        $this->type = $object['type'];
        $this->itemlevel = $object['itemlevel'];
        $this->upgradable = $object['upgradable'];
        $this->stackable = $object['stackable'];
        $this->sellable = $object['sellable'];
        $this->usable = $object['usable'];
        $this->time = $object['time'];
        $this->health = $object['health'];
        $this->strength = $object['strength'];
        $this->dexterity = $object['dexterity'];
        $this->intuition = $object['intuition'];
        $this->resistance = $object['resistance'];
        $this->attention = $object['attention'];
        $this->charism = $object['charism'];
        $this->level = $object['level'];
        $this->money = $object['money'];
        $this->honey = $object['honey'];
        $this->ore = $object['ore'];
        $this->info = $object['info'];
        $this->oil = $object['oil'];
        $this->hp = $object['hp'];
        $this->uniq = $object['uniq'];
        $this->buyable = $object['buyable'];
        $this->code = $object['code'];
        $this->sex = $object['sex'];
        $this->unlocked = $object['unlocked'];
        $this->unlockedby = $object['unlockedby'];
        $this->type2 = $object['type2'];
        $this->usestate = $object['usestate'];
        $this->shopdt1 = $object['shopdt1'];
        $this->shopdt2 = $object['shopdt2'];
        $this->ratingcrit = $object['ratingcrit'];
        $this->ratingdodge = $object['ratingdodge'];
        $this->ratingresist = $object['ratingresist'];
        $this->ratinganticrit = $object['ratinganticrit'];
        $this->ratingdamage = $object['ratingdamage'];
        $this->ratingaccur = $object['ratingaccur'];
        $this->maxlevel = $object['maxlevel'];
        $this->subtype = $object['subtype'];
        $this->special1 = $object['special1'];
        $this->special1name = $object['special1name'];
        $this->special2 = $object['special2'];
        $this->special2name = $object['special2name'];
        $this->special3 = $object['special3'];
        $this->special3name = $object['special3name'];
        $this->special4 = $object['special4'];
        $this->special4name = $object['special4name'];
        $this->special5 = $object['special5'];
        $this->special5name = $object['special5name'];
        $this->special6 = $object['special6'];
        $this->special6name = $object['special6name'];
        $this->special7 = $object['special7'];
        $this->special7name = $object['special7name'];
        $this->shop = $object['shop'];
        $this->warzub = $object['warzub'];
        $this->wargoldenzub = $object['wargoldenzub'];
        $this->huntbadge = $object['huntbadge'];
        $this->huntmobile = $object['huntmobile'];
        $this->petriks = $object['petriks'];
        $this->stars = $object['stars'];
        $this->clanlevel = $object['clanlevel'];
        $this->deleteafter = $object['deleteafter'];
        $this->deleteafterdt = $object['deleteafterdt'];
        $this->sellcost = $object['sellcost'];
    }

	/**
	 * Инициализация свойств объекта из формы (POST)
	 *
	 */
    public function initFromForm($id=0)
    {
        if ($id)
        {
            $this->id = $id;
        }
        else
        {
            if (isset($_POST['id']))
            {
                $this->id = (int) $_POST['id'];
            }
            if (isset($_GET['id']))
            {
                $this->id = (int) $_GET['id'];
            }
        }
        if (!$this->metaViewId)
        {
            $metaView = isset($_GET['metaview']) ? $_GET['metaview'] : (isset($_POST['metaview']) ? $_POST['metaview'] : 0);
            if ($metaView)
            {
                if (is_numeric((int) $metaView))
                {
                    $this->metaViewId = (int) $metaView;
                }
                else
                {
                    $this->metaViewId = $this->sql->getValue("SELECT id FROM metaview WHERE code=''");
                }
            }
        }
        if ($this->id)
        {
            $this->load($this->id);
        }
        switch ($this->metaViewId)
        {
            case 9:
                $this->name = str_replace('"', '&quot;', $_POST['name']);
                $this->maxdurability = (int) $_POST['maxdurability'];
                $this->image = str_replace('"', '&quot;', $_POST['image']);
                $this->slot = $_POST['slot'];
                $this->type = $_POST['type'];
                $this->itemlevel = (int) $_POST['itemlevel'];
                $this->upgradable = isset($_POST['upgradable']) ? 1 : 0;
                $this->stackable = isset($_POST['stackable']) ? 1 : 0;
                $this->sellable = isset($_POST['sellable']) ? 1 : 0;
                $this->usable = isset($_POST['usable']) ? 1 : 0;
                $this->time = str_replace('"', '&quot;', $_POST['time']);
                $this->health = (double) str_replace(',', '.', $_POST['health']);
                $this->strength = (double) str_replace(',', '.', $_POST['strength']);
                $this->dexterity = (double) str_replace(',', '.', $_POST['dexterity']);
                $this->intuition = (double) str_replace(',', '.', $_POST['intuition']);
                $this->resistance = (double) str_replace(',', '.', $_POST['resistance']);
                $this->attention = (double) str_replace(',', '.', $_POST['attention']);
                $this->charism = (double) str_replace(',', '.', $_POST['charism']);
                $this->level = (int) $_POST['level'];
                $this->money = (int) $_POST['money'];
                $this->honey = (int) $_POST['honey'];
                $this->ore = (int) $_POST['ore'];
                $this->info = $_POST['info'];
                $this->hp = (double) str_replace(',', '.', $_POST['hp']);
                $this->uniq = isset($_POST['uniq']) ? 1 : 0;
                $this->buyable = isset($_POST['buyable']) ? 1 : 0;
                $this->code = str_replace('"', '&quot;', $_POST['code']);
                $this->sex = $_POST['sex'];
                $this->unlocked = isset($_POST['unlocked']) ? 1 : 0;
                $this->unlockedby = $_POST['unlockedby'];
                $this->type2 = $_POST['type2'];
                $this->usestate = $_POST['usestate'];
                $this->ratingcrit = (double) str_replace(',', '.', $_POST['ratingcrit']);
                $this->ratingdodge = (double) str_replace(',', '.', $_POST['ratingdodge']);
                $this->ratingresist = (double) str_replace(',', '.', $_POST['ratingresist']);
                $this->ratinganticrit = (double) str_replace(',', '.', $_POST['ratinganticrit']);
                $this->ratingdamage = (double) str_replace(',', '.', $_POST['ratingdamage']);
                $this->ratingaccur = (double) str_replace(',', '.', $_POST['ratingaccur']);
                $this->maxlevel = (int) $_POST['maxlevel'];
                $this->subtype = $_POST['subtype'];
                $this->special1 = str_replace('"', '&quot;', $_POST['special1']);
                $this->special1name = str_replace('"', '&quot;', $_POST['special1name']);
                $this->special2 = str_replace('"', '&quot;', $_POST['special2']);
                $this->special2name = str_replace('"', '&quot;', $_POST['special2name']);
                $this->special3 = str_replace('"', '&quot;', $_POST['special3']);
                $this->special3name = str_replace('"', '&quot;', $_POST['special3name']);
                $this->special4 = str_replace('"', '&quot;', $_POST['special4']);
                $this->special4name = str_replace('"', '&quot;', $_POST['special4name']);
                $this->special5 = str_replace('"', '&quot;', $_POST['special5']);
                $this->special5name = str_replace('"', '&quot;', $_POST['special5name']);
                $this->special6 = str_replace('"', '&quot;', $_POST['special6']);
                $this->special6name = str_replace('"', '&quot;', $_POST['special6name']);
                $this->special7 = str_replace('"', '&quot;', $_POST['special7']);
                $this->special7name = str_replace('"', '&quot;', $_POST['special7name']);
                $this->warzub = (int) $_POST['warzub'];
                $this->wargoldenzub = (int) $_POST['wargoldenzub'];
                $this->huntbadge = (int) $_POST['huntbadge'];
                $this->huntmobile = (int) $_POST['huntmobile'];
                $this->petriks = (int) $_POST['petriks'];
                $this->stars = (int) $_POST['stars'];
                $this->shop = $_POST['shop'];
                $this->clanlevel = (int) $_POST['clanlevel'];
                $dt = preg_replace('/[^\d\.\-\s:]/', '', trim($_POST['shopdt1']));
                if ($dt == '')
                {
                    $dt = '00.00.0000 00:00';
                }
                $dt = explode(' ', $dt);
                $d = explode('.', $dt[0]);
                $t = strlen($dt[1]) < 6 ? $dt[1].':00' : $dt[1];
                $this->shopdt1 = $d[2].'-'.$d[1].'-'.$d[0].' '.$t;
                $dt = preg_replace('/[^\d\.\-\s:]/', '', trim($_POST['shopdt2']));
                if ($dt == '')
                {
                    $dt = '00.00.0000 00:00';
                }
                $dt = explode(' ', $dt);
                $d = explode('.', $dt[0]);
                $t = strlen($dt[1]) < 6 ? $dt[1].':00' : $dt[1];
                $this->shopdt2 = $d[2].'-'.$d[1].'-'.$d[0].' '.$t;
                $this->deleteafter = $_POST['deleteafter'];
                $this->deleteafterdt = (int) $_POST['deleteafterdt'];
                $this->oil = (int) $_POST['oil'];
                $this->sellcost = str_replace('"', '&quot;', $_POST['sellcost']);
                break;
        }
    }

	/**
	 * Сериализация свойств объекта в ассоциативный массив
	 *
	 * @return array
	 */
    public function toArray()
    {
        $object = array();
        $object['id'] = $this->id;
        $object['name'] = $this->name;
        $object['maxdurability'] = $this->maxdurability;
        $object['image'] = $this->image;
        $object['slot'] = $this->slot;
        $object['type'] = $this->type;
        $object['itemlevel'] = $this->itemlevel;
        $object['upgradable'] = $this->upgradable;
        $object['stackable'] = $this->stackable;
        $object['sellable'] = $this->sellable;
        $object['usable'] = $this->usable;
        $object['time'] = $this->time;
        $object['health'] = $this->health;
        $object['strength'] = $this->strength;
        $object['dexterity'] = $this->dexterity;
        $object['intuition'] = $this->intuition;
        $object['resistance'] = $this->resistance;
        $object['attention'] = $this->attention;
        $object['charism'] = $this->charism;
        $object['level'] = $this->level;
        $object['money'] = $this->money;
        $object['honey'] = $this->honey;
        $object['ore'] = $this->ore;
        $object['info'] = $this->info;
        $object['oil'] = $this->oil;
        $object['hp'] = $this->hp;
        $object['uniq'] = $this->uniq;
        $object['buyable'] = $this->buyable;
        $object['code'] = $this->code;
        $object['sex'] = $this->sex;
        $object['unlocked'] = $this->unlocked;
        $object['unlockedby'] = $this->unlockedby;
        $object['type2'] = $this->type2;
        $object['usestate'] = $this->usestate;
        $object['shopdt1'] = $this->shopdt1;
        $object['shopdt2'] = $this->shopdt2;
        $object['ratingcrit'] = $this->ratingcrit;
        $object['ratingdodge'] = $this->ratingdodge;
        $object['ratingresist'] = $this->ratingresist;
        $object['ratinganticrit'] = $this->ratinganticrit;
        $object['ratingdamage'] = $this->ratingdamage;
        $object['ratingaccur'] = $this->ratingaccur;
        $object['maxlevel'] = $this->maxlevel;
        $object['subtype'] = $this->subtype;
        $object['special1'] = $this->special1;
        $object['special1name'] = $this->special1name;
        $object['special2'] = $this->special2;
        $object['special2name'] = $this->special2name;
        $object['special3'] = $this->special3;
        $object['special3name'] = $this->special3name;
        $object['special4'] = $this->special4;
        $object['special4name'] = $this->special4name;
        $object['special5'] = $this->special5;
        $object['special5name'] = $this->special5name;
        $object['special6'] = $this->special6;
        $object['special6name'] = $this->special6name;
        $object['special7'] = $this->special7;
        $object['special7name'] = $this->special7name;
        $object['shop'] = $this->shop;
        $object['warzub'] = $this->warzub;
        $object['wargoldenzub'] = $this->wargoldenzub;
        $object['huntbadge'] = $this->huntbadge;
        $object['huntmobile'] = $this->huntmobile;
        $object['petriks'] = $this->petriks;
        $object['stars'] = $this->stars;
        $object['clanlevel'] = $this->clanlevel;
        $object['deleteafter'] = $this->deleteafter;
        $object['deleteafterdt'] = $this->deleteafterdt;
        $object['sellcost'] = $this->sellcost;
        return $object;
    }

	/**
	 * Сохранение объекта в базу данных в merge таблицу
	 *
	 * @param int $id
	 */
    public function saveMerge($id=0, $fields=false)
    {
    	$this->save($id, $fields, '_merge');
    }

	/**
	 * Сохранение объекта в базу данных
	 *
	 * @param int $id
	 */
    public function save($id=0, $fields=false, $saveMerge='')
    {
        if ($id)
        {
            $this->id = $id;
        }
        if ($this->id)
        {
            $object = $this->toArray();
            if ($this->globalExtention->eventsOnBeforeEdit)
            {
                $this->globalExtention->onBeforeEdit($this->id, $this);
            }
            if ($this->extention && $this->extention->eventsOnBeforeEdit)
            {
                $this->extention->onBeforeEdit($this->id, $this);
            }
            //
            $linkToObjectsMetaAttributes = array();
            //
            if ($fields) {
            	$attributes = array();
            	foreach ($fields as $field) {
            		$field = str_replace('standard_item.', '', $field);
            		switch ($this->getType($field)) {
            			case META_ATTRIBUTE_TYPE_INT:
                		case META_ATTRIBUTE_TYPE_BOOL:
		                case META_ATTRIBUTE_TYPE_FILE:
    		            case META_ATTRIBUTE_TYPE_IMAGE:
        		            $attributes[] = "`$field`=".(int)$this->{$field};
            		        break;
                		case META_ATTRIBUTE_TYPE_FLOAT:
	                	case META_ATTRIBUTE_TYPE_DOUBLE:
    	            		$attributes[] = "`$field`=".(double)$this->{$field};
	        	        	break;
    	        	    case META_ATTRIBUTE_TYPE_STRING:
        	        	case META_ATTRIBUTE_TYPE_TEXT:
	        	        case META_ATTRIBUTE_TYPE_BIGTEXT:
    	        	    case META_ATTRIBUTE_TYPE_DATA:
        	        	case META_ATTRIBUTE_TYPE_DATETIME:
	            	    case META_ATTRIBUTE_TYPE_DATE:
    	            	case META_ATTRIBUTE_TYPE_DICTIONARY:
	    	            case META_ATTRIBUTE_TYPE_CUSTOM:
    	    	        case META_ATTRIBUTE_TYPE_PASSWORD:
							$attributes[] = "`$field`='".Std::cleanString($this->{$field})."'";
	                	    break;
		                case META_ATTRIBUTE_TYPE_LINKTOOBJECT:
    		            	$attributes[] = "`$field`=".(is_object($this->{$field}) ? $this->{$field}->id : $this->{$field});	
		                	break;	
    		            case META_ATTRIBUTE_TYPE_LINKTOOBJECTS:
    		            	$linkToObjectsMetaAttributes[] = array($field);
    		            	break;
        	    	}
            	}
            	$this->sql->query("UPDATE `standard_item".$saveMerge."` SET " . implode(', ', $attributes) . " WHERE ".str_replace('.', $saveMerge . '.', self::$ID_METAATTRIBUTE)."=".$this->id);
            } else {
        		$this->sql->query("UPDATE `standard_item".$saveMerge."` SET `name`='".Std::cleanString($this->name)."', `maxdurability`=".(int)$this->maxdurability.", `image`='".Std::cleanString($this->image)."', `slot`='".Std::cleanString($this->slot)."', `type`='".Std::cleanString($this->type)."', `itemlevel`=".(int)$this->itemlevel.", `upgradable`=".(int)$this->upgradable.", `stackable`=".(int)$this->stackable.", `sellable`=".(int)$this->sellable.", `usable`=".(int)$this->usable.", `time`='".Std::cleanString($this->time)."', `health`=".(double)$this->health.", `strength`=".(double)$this->strength.", `dexterity`=".(double)$this->dexterity.", `intuition`=".(double)$this->intuition.", `resistance`=".(double)$this->resistance.", `attention`=".(double)$this->attention.", `charism`=".(double)$this->charism.", `level`=".(int)$this->level.", `money`=".(int)$this->money.", `honey`=".(int)$this->honey.", `ore`=".(int)$this->ore.", `info`='".Std::cleanString($this->info)."', `oil`=".(int)$this->oil.", `hp`=".(double)$this->hp.", `uniq`=".(int)$this->uniq.", `buyable`=".(int)$this->buyable.", `code`='".Std::cleanString($this->code)."', `sex`='".Std::cleanString($this->sex)."', `unlocked`=".(int)$this->unlocked.", `unlockedby`='".Std::cleanString($this->unlockedby)."', `type2`='".Std::cleanString($this->type2)."', `usestate`='".Std::cleanString($this->usestate)."', `shopdt1`='".Std::cleanString($this->shopdt1)."', `shopdt2`='".Std::cleanString($this->shopdt2)."', `ratingcrit`=".(double)$this->ratingcrit.", `ratingdodge`=".(double)$this->ratingdodge.", `ratingresist`=".(double)$this->ratingresist.", `ratinganticrit`=".(double)$this->ratinganticrit.", `ratingdamage`=".(double)$this->ratingdamage.", `ratingaccur`=".(double)$this->ratingaccur.", `maxlevel`=".(int)$this->maxlevel.", `subtype`='".Std::cleanString($this->subtype)."', `special1`='".Std::cleanString($this->special1)."', `special1name`='".Std::cleanString($this->special1name)."', `special2`='".Std::cleanString($this->special2)."', `special2name`='".Std::cleanString($this->special2name)."', `special3`='".Std::cleanString($this->special3)."', `special3name`='".Std::cleanString($this->special3name)."', `special4`='".Std::cleanString($this->special4)."', `special4name`='".Std::cleanString($this->special4name)."', `special5`='".Std::cleanString($this->special5)."', `special5name`='".Std::cleanString($this->special5name)."', `special6`='".Std::cleanString($this->special6)."', `special6name`='".Std::cleanString($this->special6name)."', `special7`='".Std::cleanString($this->special7)."', `special7name`='".Std::cleanString($this->special7name)."', `shop`='".Std::cleanString($this->shop)."', `warzub`=".(int)$this->warzub.", `wargoldenzub`=".(int)$this->wargoldenzub.", `huntbadge`=".(int)$this->huntbadge.", `huntmobile`=".(int)$this->huntmobile.", `petriks`=".(int)$this->petriks.", `stars`=".(int)$this->stars.", `clanlevel`=".(int)$this->clanlevel.", `deleteafter`='".Std::cleanString($this->deleteafter)."', `deleteafterdt`=".(int)$this->deleteafterdt.", `sellcost`='".Std::cleanString($this->sellcost)."' WHERE ".str_replace('.', $saveMerge . '.', self::$ID_METAATTRIBUTE)."=".$this->id);
        	}
         	if (sizeof($linkToObjectsMetaAttributes) > 0) {
        	   	foreach ($linkToObjectsMetaAttributes as $metaAttributeCode) {
        	   		$this->processLinkToObjects($metaAttributeCode);
          		}
        	}
        	//
            if ($this->globalExtention->eventsOnAfterEdit)
            {
                $this->globalExtention->onAfterEdit($this->id, $this);
            }
            if ($this->extention && $this->extention->eventsOnAfterEdit)
            {
                $this->extention->onAfterEdit($this->id, $this);
            }
        }
        else
        {
            $object = $this->toArray();
            if ($this->globalExtention->eventsOnBeforeCreate)
            {
                $this->globalExtention->onBeforeCreate($this);
            }
            if ($this->extention && $this->extention->eventsOnBeforeCreate)
            {
                $this->extention->onBeforeCreate($this);
            }
            //
            $this->id = $this->sql->insert("INSERT INTO `standard_item".$saveMerge."` (`name`, `maxdurability`, `image`, `slot`, `type`, `itemlevel`, `upgradable`, `stackable`, `sellable`, `usable`, `time`, `health`, `strength`, `dexterity`, `intuition`, `resistance`, `attention`, `charism`, `level`, `money`, `honey`, `ore`, `info`, `oil`, `hp`, `uniq`, `buyable`, `code`, `sex`, `unlocked`, `unlockedby`, `type2`, `usestate`, `shopdt1`, `shopdt2`, `ratingcrit`, `ratingdodge`, `ratingresist`, `ratinganticrit`, `ratingdamage`, `ratingaccur`, `maxlevel`, `subtype`, `special1`, `special1name`, `special2`, `special2name`, `special3`, `special3name`, `special4`, `special4name`, `special5`, `special5name`, `special6`, `special6name`, `special7`, `special7name`, `shop`, `warzub`, `wargoldenzub`, `huntbadge`, `huntmobile`, `petriks`, `stars`, `clanlevel`, `deleteafter`, `deleteafterdt`, `sellcost`) VALUES ('".Std::cleanString($this->name)."', ".(int)$this->maxdurability.", '".Std::cleanString($this->image)."', '".Std::cleanString($this->slot)."', '".Std::cleanString($this->type)."', ".(int)$this->itemlevel.", ".(int)$this->upgradable.", ".(int)$this->stackable.", ".(int)$this->sellable.", ".(int)$this->usable.", '".Std::cleanString($this->time)."', ".(double)$this->health.", ".(double)$this->strength.", ".(double)$this->dexterity.", ".(double)$this->intuition.", ".(double)$this->resistance.", ".(double)$this->attention.", ".(double)$this->charism.", ".(int)$this->level.", ".(int)$this->money.", ".(int)$this->honey.", ".(int)$this->ore.", '".Std::cleanString($this->info)."', ".(int)$this->oil.", ".(double)$this->hp.", ".(int)$this->uniq.", ".(int)$this->buyable.", '".Std::cleanString($this->code)."', '".Std::cleanString($this->sex)."', ".(int)$this->unlocked.", '".Std::cleanString($this->unlockedby)."', '".Std::cleanString($this->type2)."', '".Std::cleanString($this->usestate)."', '".Std::cleanString($this->shopdt1)."', '".Std::cleanString($this->shopdt2)."', ".(double)$this->ratingcrit.", ".(double)$this->ratingdodge.", ".(double)$this->ratingresist.", ".(double)$this->ratinganticrit.", ".(double)$this->ratingdamage.", ".(double)$this->ratingaccur.", ".(int)$this->maxlevel.", '".Std::cleanString($this->subtype)."', '".Std::cleanString($this->special1)."', '".Std::cleanString($this->special1name)."', '".Std::cleanString($this->special2)."', '".Std::cleanString($this->special2name)."', '".Std::cleanString($this->special3)."', '".Std::cleanString($this->special3name)."', '".Std::cleanString($this->special4)."', '".Std::cleanString($this->special4name)."', '".Std::cleanString($this->special5)."', '".Std::cleanString($this->special5name)."', '".Std::cleanString($this->special6)."', '".Std::cleanString($this->special6name)."', '".Std::cleanString($this->special7)."', '".Std::cleanString($this->special7name)."', '".Std::cleanString($this->shop)."', ".(int)$this->warzub.", ".(int)$this->wargoldenzub.", ".(int)$this->huntbadge.", ".(int)$this->huntmobile.", ".(int)$this->petriks.", ".(int)$this->stars.", ".(int)$this->clanlevel.", '".Std::cleanString($this->deleteafter)."', ".(int)$this->deleteafterdt.", '".Std::cleanString($this->sellcost)."')");
        	//
            if ($this->globalExtention->eventsOnAfterCreate)
            {
                $this->globalExtention->onAfterCreate($this->id, $this);
            }
            if ($this->extention && $this->extention->eventsOnAfterCreate)
            {
                $this->extention->onAfterCreate($this->id, $this);
            }
        }
    }
    
    private function processLinkToObjects($metaAttributeCode)
    {
    	if (is_array($metaAttributeCode)) {
            $metaAttributeCode = $metaAttributeCode[0];
        }
        $metaAttributeId = $this->sql->getValue("SELECT id FROM metaattribute WHERE metaobject_id=(SELECT id FROM metaobject WHERE code='{$this->metaObjectCode}') AND code='$metaAttributeCode'");
    	$this->sql->query("DELETE FROM metalink WHERE metaattribute_id=$metaAttributeId AND object_id={$this->id}");
	    if (sizeof($this->{$metaAttributeCode}) > 0) {
			foreach ($this->{$metaAttributeCode} as $linkedObjectId) {
            	$this->sql->query("INSERT INTO metalink (metaattribute_id, object_id, linkedobject_id) VALUES ($metaAttributeId, {$this->id}, $linkedObjectId)");
	        }
		}
    }
    
    private function getType($fieldCode)
    {
    	switch ($fieldCode) {
			case 'id': return 1; break;
			case 'name': return 4; break;
			case 'maxdurability': return 2; break;
			case 'image': return 4; break;
			case 'slot': return 15; break;
			case 'type': return 15; break;
			case 'itemlevel': return 2; break;
			case 'upgradable': return 10; break;
			case 'stackable': return 10; break;
			case 'sellable': return 10; break;
			case 'usable': return 10; break;
			case 'time': return 4; break;
			case 'health': return 3; break;
			case 'strength': return 3; break;
			case 'dexterity': return 3; break;
			case 'intuition': return 3; break;
			case 'resistance': return 3; break;
			case 'attention': return 3; break;
			case 'charism': return 3; break;
			case 'level': return 2; break;
			case 'money': return 2; break;
			case 'honey': return 2; break;
			case 'ore': return 2; break;
			case 'info': return 5; break;
			case 'oil': return 2; break;
			case 'hp': return 3; break;
			case 'uniq': return 10; break;
			case 'buyable': return 10; break;
			case 'code': return 4; break;
			case 'sex': return 15; break;
			case 'unlocked': return 10; break;
			case 'unlockedby': return 5; break;
			case 'type2': return 15; break;
			case 'usestate': return 15; break;
			case 'shopdt1': return 8; break;
			case 'shopdt2': return 8; break;
			case 'ratingcrit': return 3; break;
			case 'ratingdodge': return 3; break;
			case 'ratingresist': return 3; break;
			case 'ratinganticrit': return 3; break;
			case 'ratingdamage': return 3; break;
			case 'ratingaccur': return 3; break;
			case 'maxlevel': return 2; break;
			case 'subtype': return 15; break;
			case 'special1': return 4; break;
			case 'special1name': return 4; break;
			case 'special2': return 4; break;
			case 'special2name': return 4; break;
			case 'special3': return 4; break;
			case 'special3name': return 4; break;
			case 'special4': return 4; break;
			case 'special4name': return 4; break;
			case 'special5': return 4; break;
			case 'special5name': return 4; break;
			case 'special6': return 4; break;
			case 'special6name': return 4; break;
			case 'special7': return 4; break;
			case 'special7name': return 4; break;
			case 'shop': return 15; break;
			case 'warzub': return 2; break;
			case 'wargoldenzub': return 2; break;
			case 'huntbadge': return 2; break;
			case 'huntmobile': return 2; break;
			case 'petriks': return 2; break;
			case 'stars': return 2; break;
			case 'clanlevel': return 2; break;
			case 'deleteafter': return 15; break;
			case 'deleteafterdt': return 2; break;
			case 'sellcost': return 4; break;
    	}
    }
}
?>